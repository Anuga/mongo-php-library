<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Upgrade Guide - MongoDB PHP library</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Upgrade Guide";
    var mkdocs_page_input_path = "upgrade-guide.md";
    var mkdocs_page_url = "/upgrade-guide/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 
  <script src="../pretty.js"></script>

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> MongoDB PHP library</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../getting-started/">Getting Started</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Upgrade Guide</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#upgrade-guide">Upgrade Guide</a></li>
                
                    <li><a class="toctree-l4" href="#collection-api">Collection API</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Tutorial</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../tutorial/bson/">BSON Conversion</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../tutorial/crud/">CRUD Operations</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../tutorial/commands/">Database Commands</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../tutorial/indexes/">Indexes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../tutorial/example-data/">Example Data</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Classes</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../classes/client/">Client</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../classes/database/">Database</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../classes/collection/">Collection</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">MongoDB PHP library</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Upgrade Guide</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/mongodb/mongo-php-library" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="upgrade-guide">Upgrade Guide<a class="headerlink" href="#upgrade-guide" title="Permanent link">&para;</a></h1>
<p>The MongoDB PHP Library and underlying <a href="http://php.net/mongodb">mongodb extension</a> have
notable API differences from the legacy <a href="http://php.net/mongo">mongo extension</a>. This page
will attempt to summarize those differences for the benefit of those upgrading 
rom the legacy driver.</p>
<p>Additionally, a community-developed <a href="https://github.com/alcaeus/mongo-php-adapter">mongo-php-adapter</a> library exists,
which implements the <a href="http://php.net/mongo">mongo extension</a> API using this library and the
new driver. While this adapter library is not officially supported by MongoDB,
it does bear mentioning.</p>
<h2 id="collection-api">Collection API<a class="headerlink" href="#collection-api" title="Permanent link">&para;</a></h2>
<p>This library&rsquo;s <a href="../classes/collection/">MongoDB\Collection</a> class implements MongoDB&rsquo;s
cross-driver <a href="https://github.com/mongodb/specifications/blob/master/source/crud/crud.rst">CRUD</a> and <a href="https://github.com/mongodb/specifications/blob/master/source/index-management.rst">Index Management</a>
specifications. Although some method names have changed in accordance with the
new specifications, the new class provides the same functionality as the legacy
driver&rsquo;s <a href="http://php.net/mongocollection">MongoCollection</a> class with some notable exceptions.</p>
<h3 id="old-and-new-methods">Old and New Methods<a class="headerlink" href="#old-and-new-methods" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th><a href="http://php.net/mongocollection">MongoCollection</a></th>
<th><a href="../classes/collection/">MongoDB\Collection</a></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.aggregate.php">aggregate()</a></td>
<td><a href="../classes/collection/#aggregate">aggregate()</a></td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.aggregatecursor.php">aggregateCursor()</a></td>
<td><a href="../classes/collection/#aggregate">aggregate()</a></td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.batchinsert.php">batchInsert()</a></td>
<td><a href="../classes/collection/#insertmany">insertMany()</a></td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.count.php">count()</a></td>
<td><a href="../classes/collection/#count">count()</a></td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.createdbref.php">createDBRef()</a></td>
<td>Not yet implemented (<a href="https://jira.mongodb.org/browse/PHPLIB-24">PHPLIB-24</a>)</td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.createindex.php">createIndex()</a></td>
<td><a href="../classes/collection/#createindex">createIndex()</a></td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.deleteindex.php">deleteIndex()</a></td>
<td><a href="../classes/collection/#dropindex">dropIndex()</a></td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.deleteindexes.php">deleteIndexes()</a></td>
<td><a href="../classes/collection/#dropindexes">dropIndexes()</a></td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.drop.php">drop()</a></td>
<td><a href="../classes/collection/#drop">drop()</a></td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.distinct.php">distinct()</a></td>
<td><a href="../classes/collection/#distinct">distinct()</a></td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.ensureindex.php">ensureIndex()</a></td>
<td><a href="../classes/collection/#createindex">createIndex()</a></td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.find.php">find()</a></td>
<td><a href="../classes/collection/#find">find()</a></td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.findandmodify.php">findAndModify()</a></td>
<td><a href="../classes/collection/#findoneanddelete">findOneAndDelete()</a>, <a href="../classes/collection/#findoneandreplace">findOneAndReplace()</a>, and <a href="../classes/collection/#findoneandupdate">findOneAndUpdate()</a></td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.findone.php">findOne()</a></td>
<td><a href="../classes/collection/#findone">findOne()</a></td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.getdbref.php">getDBRef()</a></td>
<td>Not yet implemented (<a href="https://jira.mongodb.org/browse/PHPLIB-24">PHPLIB-24</a>)</td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.getindexinfo.php">getIndexInfo()</a></td>
<td><a href="../classes/collection/#listindexes">listIndexes()</a></td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.getname.php">getName()</a></td>
<td><a href="../classes/collection/#getcollectionname">getCollectionName()</a></td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.getreadpreference.php">getReadPreference()</a></td>
<td>Not implemented</td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.getslaveokay.php">getSlaveOkay()</a></td>
<td>Not implemented</td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.getwriteconcern.php">getWriteConcern()</a></td>
<td>Not implemented</td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.group.php">group()</a></td>
<td>Not yet implemented (<a href="https://jira.mongodb.org/browse/PHPLIB-177">PHPLIB-177</a>). Use <a href="../classes/database/#command">Database::command()</a> for now.</td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.insert.php">insert()</a></td>
<td><a href="../classes/collection/#insertone">insertOne()</a></td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.parallelcollectionscan.php">parallelCollectionScan()</a></td>
<td>Not implemented</td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.remove.php">remove()</a></td>
<td><a href="../classes/collection/#deleteMany">deleteMany()</a> and <a href="../classes/collection/#deleteone">deleteOne()</a></td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.save.php">save()</a></td>
<td><a href="../classes/collection/#insertone">insertOne()</a> or <a href="../classes/collection/#replaceone">replaceOne()</a> with &ldquo;upsert&rdquo; option</td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.setreadpreference.php">sgetReadPreference()</a></td>
<td>Not implemented. Use <a href="../classes/collection/#withoptions">withOptions()</a>.</td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.getslaveokay.php">setSlaveOkay()</a></td>
<td>Not implemented</td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.setwriteconcern.php">setWriteConcern()</a></td>
<td>Not implemented. Use <a href="../classes/collection/#withoptions">withOptions()</a>.</td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.update.php">update()</a></td>
<td><a href="../classes/collection/#replaceone">replaceOne()</a>, <a href="../classes/collection/#updatemany">updateMany()</a>, and <a href="../classes/collection/#updateone">updateOne()</a></td>
</tr>
<tr>
<td><a href="http://php.net/manual/en/mongocollection.validate.php">validate()</a></td>
<td>Not implemented</td>
</tr>
</tbody>
</table>
<p>A guiding principle in designing the new APIs was that explicit method names
are preferable to overloaded terms found in the old API. For instance,
<a href="http://php.net/manual/en/mongocollection.save.php">MongoCollection::save()</a> and 
<a href="http://php.net/manual/en/mongocollection.findandmodify.php">MongoCollection::findAndModify()</a> have very different modes of
operation, depending on their arguments. Methods were also split to distinguish
between <a href="https://docs.mongodb.org/manual/tutorial/modify-documents/#update-specific-fields-in-a-document">updating specific fields</a> and
<a href="https://docs.mongodb.org/manual/tutorial/modify-documents/#replace-the-document">full-document replacement</a>.</p>
<h3 id="group-command-helper">Group Command Helper<a class="headerlink" href="#group-command-helper" title="Permanent link">&para;</a></h3>
<p><a href="../classes/collection/">MongoDB\Collection</a> does not yet have a helper method for the
<a href="https://docs.mongodb.org/manual/reference/command/group/">group</a> command; however, that is planned in <a href="https://jira.mongodb.org/browse/PHPLIB-177">PHPLIB-177</a>.
The following example demonstrates how to execute a group command using
<a href="../classes/database/#command">Database::command()</a>:</p>
<pre><code class="php">&lt;?php

$database = (new MongoDB\Client)-&gt;selectDatabase('db_name');
$cursor = $database-&gt;command([
    'group' =&gt; [
        'ns' =&gt; 'collection_name',
        'key' =&gt; ['field_name' =&gt; 1],
        'initial' =&gt; ['total' =&gt; 0],
        '$reduce' =&gt; new MongoDB\BSON\Javascript('...'),
    ],
]);

$resultDocument = $cursor-&gt;toArray()[0];
</code></pre>

<h3 id="mapreduce-command-helper">MapReduce Command Helper<a class="headerlink" href="#mapreduce-command-helper" title="Permanent link">&para;</a></h3>
<p><a href="../classes/collection/">MongoDB\Collection</a> does not yet have a helper method for the
<a href="https://docs.mongodb.org/manual/reference/command/mapReduce/">mapReduce</a> command; however, that is planned in
<a href="https://jira.mongodb.org/browse/PHPLIB-53">PHPLIB-53</a>. The following example demonstrates how to execute a
mapReduce command using <a href="../classes/database/#command">Database::command()</a>:</p>
<pre><code class="php">&lt;?php

$database = (new MongoDB\Client)-&gt;selectDatabase('db_name');
$cursor = $database-&gt;command([
    'mapReduce' =&gt; 'collection_name',
    'map' =&gt; new MongoDB\BSON\Javascript('...'),
    'reduce' =&gt; new MongoDB\BSON\Javascript('...'),
    'out' =&gt; 'output_collection_name',
]);

$resultDocument = $cursor-&gt;toArray()[0];
</code></pre>

<h3 id="dbref-helpers">DBRef Helpers<a class="headerlink" href="#dbref-helpers" title="Permanent link">&para;</a></h3>
<p><a href="../classes/collection/">MongoDB\Collection</a> does not yet have helper methods for working
with <a href="https://docs.mongodb.org/manual/reference/database-references/#dbrefs">DBRef</a> objects; however, that is planned in
<a href="https://jira.mongodb.org/browse/PHPLIB-24">PHPLIB-24</a>.</p>
<h3 id="mongocollectionsave-removed">MongoCollection::save() Removed<a class="headerlink" href="#mongocollectionsave-removed" title="Permanent link">&para;</a></h3>
<p><a href="http://php.net/manual/en/mongocollection.save.php">MongoCollection::save()</a>, which was syntactic sugar for an insert or
upsert operation, has been removed in favor of explicitly using
<a href="../classes/collection/#insertone">insertOne()</a> or
<a href="../classes/collection/#replaceone">replaceOne()</a> (with the &ldquo;upsert&rdquo; option).</p>
<p><img alt="save() flowchart" src="../img/save-flowchart.png" /></p>
<p>While the <a href="http://php.net/manual/en/mongocollection.save.php">save()</a> method does have its uses for interactive environments,
such as the mongo shell, it was intentionally excluded from the
<a href="https://github.com/mongodb/specifications/blob/master/source/crud/crud.rst">CRUD</a> specification for language drivers. Generally, application
code should know if the document has an identifier and be able to explicitly
insert or replace the document and handle the returned InsertResult or
UpdateResult, respectively. This also helps avoid inadvertent and potentially
dangerous <a href="https://docs.mongodb.org/manual/tutorial/modify-documents/#replace-the-document">full-document replacements</a>.</p>
<h3 id="mongowritebatch">MongoWriteBatch<a class="headerlink" href="#mongowritebatch" title="Permanent link">&para;</a></h3>
<p>The legacy driver&rsquo;s <a href="http://php.net/manual/en/class.mongowritebatch.php">MongoWriteBatch</a> classes have been replaced with a
general-purpose <a href="../classes/collection/#bulkwrite">bulkWrite()</a> method. Whereas
the legacy driver only allowed bulk operations of the same time, the new method
allows operations to be mixed (e.g. inserts, updates, and deletes).</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../tutorial/bson/" class="btn btn-neutral float-right" title="BSON Conversion">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../getting-started/" class="btn btn-neutral" title="Getting Started"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/mongodb/mongo-php-library" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../getting-started/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../tutorial/bson/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
