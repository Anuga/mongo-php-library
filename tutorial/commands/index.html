<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Database Commands - MongoDB PHP library</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Database Commands";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 
  <script src="../../pretty.js"></script>

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> MongoDB PHP library</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../getting-started/">Getting Started</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../upgrade-guide/">Upgrade Guide</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Tutorial</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../bson/">BSON Conversion</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../crud/">CRUD Operations</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Database Commands</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#database-commands">Database Commands</a></li>
                
                    <li><a class="toctree-l4" href="#single-result-documents">Single Result Documents</a></li>
                
                    <li><a class="toctree-l4" href="#iterable-results-as-a-command-cursor">Iterable Results as a Command Cursor</a></li>
                
                    <li><a class="toctree-l4" href="#specifying-a-read-preference">Specifying a Read Preference</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../indexes/">Indexes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../example-data/">Example Data</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Classes</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../classes/client/">Client</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../classes/database/">Database</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../classes/collection/">Collection</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">MongoDB PHP library</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Tutorial &raquo;</li>
        
      
    
    <li>Database Commands</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/mongodb/mongo-php-library" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="database-commands">Database Commands<a class="headerlink" href="#database-commands" title="Permanent link">&para;</a></h1>
<p>While the library provides helpers for some common database commands, it is far
from an <a href="https://docs.mongodb.org/manual/reference/command/">exhaustive list</a>. This page will demonstrate how to
execute arbitrary commands on the MongoDB server via the
<a href="../../classes/database/#command">Database::command()</a> method and access their results.</p>
<h2 id="single-result-documents">Single Result Documents<a class="headerlink" href="#single-result-documents" title="Permanent link">&para;</a></h2>
<p>The <a href="../../classes/database/#command">command()</a> method always returns a
<a href="http://php.net/mongodb-driver-cursor">MongoDB\Driver\Cursor</a>. Unless otherwise stated in the MongoDB
documentation, command responses are returned as a single document. Reading such
a result will require iterating on the cursor and accessing the first (and only)
document, like so:</p>
<pre><code>&lt;?php

$database = (new MongoDB\Client)-&gt;demo;

$cursor = $database-&gt;command(['ping' =&gt; 1]);

var_dump($cursor-&gt;toArray()[0]);
</code></pre>

<p>The above example would output something similar to:</p>
<pre><code>object(MongoDB\Model\BSONDocument)#2 (1) {
  [&quot;storage&quot;:&quot;ArrayObject&quot;:private]=&gt;
  array(1) {
    [&quot;ok&quot;]=&gt;
    float(1)
  }
}
</code></pre>

<h2 id="iterable-results-as-a-command-cursor">Iterable Results as a Command Cursor<a class="headerlink" href="#iterable-results-as-a-command-cursor" title="Permanent link">&para;</a></h2>
<p>Some commands, such as <a href="http://docs.mongodb.org/manual/reference/command/listCollections/">listCollections</a>, return their results
via an iterable command cursor. In this case, the returned
<a href="http://php.net/mongodb-driver-cursor">MongoDB\Driver\Cursor</a> may be iterated in the same manner as one might
do with a <a href="../../classes/collection/#find">Collection::find()</a> query, like so:</p>
<pre><code>&lt;?php

$database = (new MongoDB\Client)-&gt;demo;

$cursor = $database-&gt;command(['listCollections' =&gt; 1]);

foreach ($cursor as $collection) {
    echo $collection['name'], &quot;\n&quot;;
}
</code></pre>

<p>The above example would output something similar to:</p>
<pre><code>persons
posts
zips
</code></pre>

<p><strong>Note:</strong> at the protocol level, commands that support a cursor actually return
a single result document with the essential ingredients for constructing the
command cursor (i.e. the cursor&rsquo;s ID, namespace, and first batch of results);
however, the driver&rsquo;s <a href="http://php.net/manual/en/mongodb-driver-manager.executecommand.php">executeCommand()</a> method already detects
such a result and constructs the iterable command cursor for us.</p>
<h2 id="specifying-a-read-preference">Specifying a Read Preference<a class="headerlink" href="#specifying-a-read-preference" title="Permanent link">&para;</a></h2>
<p>Some commands, such as <a href="https://docs.mongodb.org/manual/reference/command/createUser/">createUser</a>, can only be executed on a
primary server. Command helpers in the library, such as
<a href="../../classes/database/#drop">Database::drop()</a>, know to apply their own read preference if necessary;
however, <a href="../../classes/database/#command">command()</a> is a generic method and has no special knowledge.
It defaults to the read preference of the Database object on which it is
invoked. In such cases, it can be helpful to explicitly specify the correct read
preference, like so:</p>
<pre><code>&lt;?php

$db = (new MongoDB\Client)-&gt;demo;

$cursor = $db-&gt;command(
    [
        'createUser' =&gt; 'username',
        'pwd' =&gt; 'password',
        'roles' =&gt; ['readWrite'],
    ],
    [
        'readPreference' =&gt; new MongoDB\Driver\ReadPreference(MongoDB\Driver\ReadPreference::RP_PRIMARY),
    ]
);

var_dump($cursor-&gt;toArray()[0]);
</code></pre>

<p>The above example would output something similar to:</p>
<pre><code>object(MongoDB\Model\BSONDocument)#8 (1) {
  [&quot;storage&quot;:&quot;ArrayObject&quot;:private]=&gt;
  array(1) {
    [&quot;ok&quot;]=&gt;
    float(1)
  }
}
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../indexes/" class="btn btn-neutral float-right" title="Indexes"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../crud/" class="btn btn-neutral" title="CRUD Operations"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../crud/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../indexes/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
